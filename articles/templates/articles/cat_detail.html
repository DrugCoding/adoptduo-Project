{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% block content %}
{{ cat_article.title }}
<a href="{% url 'articles:cat_update' cat_article.pk %}" class="btn detail_btn2 mx-2 my-3">글수정</a>
<a href="{% url 'articles:cat_delete' cat_article.pk %}" class="btn detail_btn2 my-3">글삭제</a>

<h4 class="my-3">댓글</h4>
<form id="cat-comment-form" data-article-id="{{ cat_article.pk }}">
    {% csrf_token %}
    {% bootstrap_form cat_comment_form %}
    {% bootstrap_button button_type="submit" content="OK" %}
</form>
<hr>
<p>{{ cat_comments.count }}개의 댓글이 있습니다.</p>
<div id="cat-comments">
    {% for cat_comment in cat_comments %}
        <p> {{ cat_comment.user.username }} | {{ cat_comment.content }}</p>
        <hr>    
    {% empty %}
        <p>댓글이 없어요 ㅠ_ㅠ</p>
    {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const commentForm = document.querySelector('#cat-comment-form')
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    commentForm.addEventListener('submit', function(event){
        event.preventDefault();
        axios({
          method: 'post',
          url: `/${event.target.dataset.articleId}/cat/comments/`,
          headers: {'X-CSRFToken': csrftoken},
          data: new FormData(commentForm) // 폼에 있는 정보를 data로 넘겨줄 수 있도록 변환
        })
        .then(response => {
          console.log(response.data)
          // 댓글을 추가하는 로직
          const comments = document.querySelector('#cat-comments')
          const p = document.createElement('p')
          p.innerText = `${response.data.cat_userName} | ${response.data.cat_content}`
          const hr = document.createElement('hr')
          comments.append(p, hr) 
          commentForm.reset()
        })
      })
</script>
{% endblock %}
